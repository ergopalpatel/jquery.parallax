/**************************************************\
|* Script Author: Djordje Jocic                   *|
|* Script Year: 2015                              *|
|* Script Version: 1.0.2                          *|
|* Script License: MIT License (MIT)              *|
|* ============================================== *|
|* Official Website: http://www.djordjejocic.com/ *|
|* ============================================== *|
|* Permission is hereby granted, free of charge,  *|
|* to any person obtaining a copy of this         *|
|* software and associated documentation files    *|
|* (the "Software"), to deal in the Software      *|
|* without restriction, including without         *|
|* limitation the rights to use, copy, modify,    *|
|* merge, publish, distribute, sublicense, and/or *|
|* sell copies of the Software, and to permit     *|
|* persons to whom the Software is furnished to   *|
|* do so, subject to the following conditions:    *|
|* ---------------------------------------------- *|
|* The above copyright notice and this permission *|
|* notice shall be included in all copies or      *|
|* substantial portions of the Software.          *|
|* ---------------------------------------------- *|
|* THE SOFTWARE IS PROVIDED "AS IS", WITHOUT      *|
|* WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,      *|
|* INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF *|
|* MERCHANTABILITY, FITNESS FOR A PARTICULAR      *|
|* PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL *|
|* THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR *|
|* ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER *|
|* IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,   *|
|* RISING FROM, OUT OF OR IN CONNECTION WITH THE  *|
|* SOFTWARE OR THE USE OR OTHER DEALINGS IN THE   *|
|* SOFTWARE.                                      *|
\**************************************************/

function ParallaxRenderer(){this.render=function(a,b,c){if(c.parallaxInit){var d=this.calculateParallaxRatio(a,c.start,c.end);a-=b.offset().top;var e=-Math.floor(d*c.offset),f=this.parsePosition(b.css("background-position"));f.left+="px",f.top=e+"px",b.css("background-position",f.left+" "+f.top)}},this.parseLocation=function(a){return a.trim().replace(/^((url\()+(`|'|"))/,"").replace(/((`|'|")+(\)))$/,"")},this.parsePosition=function(a){var b={left:0,top:0};return a=a.replace(/[^0-9\s]/g,"").trim().split(" ",2),b.left=a[0],b.top=a[1],b},this.clamp=function(a,b,c){return a<b?b:a>c?c:a},this.calculateOffset=function(a,b){if(b.height>=a.height)return 0;var c=b.width()/a.width;return Math.floor(a.height*c)-b.height()},this.calculateParallaxRatio=function(a,b,c){return b=b<0?0:b,a-=b,c-=b,a/c}}!function(a){a.fn.parallaxCore={scrollDefault:[],scrollManual:[],countDefault:0,countManual:0,refreshTimeout:null,renderer:new ParallaxRenderer},a.fn.parallax=function(b){var c=a(this);if(void 0===a(this).data("parallaxSettings")){var e=new Image,f=a("<div />",{class:"parallax-preloader",style:"display: none;"});void 0===b&&(b={image:null,height:null,billboard:!0,scroll:"default"}),b.parallaxInit=!0,e.onload=function(){f.remove(),b.offset=a.fn.parallaxCore.renderer.calculateOffset(e,c),c.data("parallaxSettings",b),"default"===b.scroll?(a.fn.parallaxCore.scrollDefault.push(c),a.fn.parallaxCore.countDefault++):"manual"===b.scroll&&(a.fn.parallaxCore.scrollManual.push(c),a.fn.parallaxCore.countManual++)},f.appendTo(c),setTimeout(function(){f.show()},1e3),null==b.image?e.src=a.fn.parallaxCore.renderer.parseLocation(c.css("background-image")):(c.css({"background-image":"url("+b.image+")","background-size":"100% auto"}),e.src=b.image),null==b.height?b.height=c.height():c.height(b.height),b.start=c.offset().top-a(window).height(),b.end=c.height()+c.offset().top}},a.fn.parallaxScroll=function(b){var c=a(this),d=a(this).data("parallaxSettings");a.isEmptyObject(d)||b>=d.start&&b<=d.end&&a.fn.parallaxCore.renderer.render(b,c,d)},a(document).scroll(function(){for(var b=a(this).scrollTop(),c=null,d=null,e=0;e<a.fn.parallaxCore.countDefault;e++)c=a.fn.parallaxCore.scrollDefault[e],d=a.fn.parallaxCore.scrollDefault[e].data("parallaxSettings"),b>=d.start&&b<=d.end&&a.fn.parallaxCore.renderer.render(b,c,d)}),a(window).resize(function(){null==a.fn.parallaxCore.refreshTimeout&&(a.fn.parallaxCore.refreshTimeout=setTimeout(function(){for(var b=null,c=null,d=0;d<a.fn.parallaxCore.countDefault;d++)b=a.fn.parallaxCore.scrollDefault[d],c=a.fn.parallaxCore.scrollDefault[d].data("parallaxSettings"),c.start=b.offset().top-a(window).height(),c.end=b.height()+b.offset().top,a.fn.parallaxCore.scrollDefault[d].data("parallaxSettings",c);for(var d=0;d<a.fn.parallaxCore.countManual;d++)b=a.fn.parallaxCore.scrollManual[d],c=a.fn.parallaxCore.scrollManual[d].data("parallaxSettings"),c.start=b.offset().top-a(window).height(),c.end=b.height()+b.offset().top,a.fn.parallaxCore.scrollManual[d].data("parallaxSettings",c);a.fn.parallaxCore.refreshTimeout=null},1e3))})}(jQuery);
